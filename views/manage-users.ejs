<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Manage Users</title>
    <style>
        body { font-family: system-ui, sans-serif; background-color: #f0f2f5; color: #1c1e21; margin: 0; padding: 2em; }
        .container { max-width: 800px; margin: auto; }
        h1, h2 { color: #000; }
        nav a { text-decoration: none; font-weight: bold; color: #0866ff; font-size: 1.1em; }
        .panel { background: white; padding: 1.5em; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-top: 2em; }
        .tab-container { display: flex; border-bottom: 2px solid #ccc; margin-bottom: 1.5em; }
        .tab-button { background: #e9ebee; border: 1px solid #ccc; padding: 10px 20px; cursor: pointer; font-size: 1.1em; border-bottom: none; border-radius: 6px 6px 0 0; margin-right: 5px; color: #1c1e21; }
        .tab-button.active { background: white; border-bottom: 2px solid white; position: relative; top: 2px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-section { display: grid; grid-template-columns: 1fr 1fr; gap: 2em; }
        .form-column { padding: 1em; }
        .form-column h3 { margin-top: 0; border-bottom: 1px solid #ddd; padding-bottom: 0.5em; }
        form { display: flex; flex-direction: column; gap: 1em; }
        input, select { padding: 0.8em; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; width: 100%; box-sizing: border-box; }
        button { padding: 0.8em 1.5em; color: white; border: none; border-radius: 4px; font-size: 1.1em; cursor: pointer; }
        .btn-submit { background-color: #0866ff; }
        .btn-upload { background-color: #31a24c; }
        .flash { padding: 1em; margin-bottom: 1em; border-radius: 4px; text-align: center; }
        .flash.success { background-color: #d4edda; color: #155724; }
        .flash.error { background-color: #f8d7da; color: #721c24; }
        .instructions { background-color: #e7f3ff; border-left: 5px solid #0866ff; padding: 1em; margin-top: 1.5em; text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <nav><a href="/">&larr; Back to Live Dashboard</a></nav>

        <div class="panel">
            <h1>Manage Users</h1>
            <% if (messages.success) { %><div class="flash success"><%= messages.success %></div><% } %>
            <% if (messages.error) { %><div class="flash error"><%= messages.error %></div><% } %>

            <div class="tab-container">
                <button class="tab-button active" onclick="openTab('students')">Manage Students</button>
                <button class="tab-button" onclick="openTab('faculty')">Manage Faculty</button>
            </div>

            <!-- Student Management Tab -->
            <div id="students" class="tab-content active">
                <div class="form-section">
                    <div class="form-column">
                        <h3>Add Student Manually</h3>
                        <form action="/add-student-manual" method="post">
                            <input type="text" name="user_id" placeholder="Roll Number" required>
                            <input type="text" name="user_name" placeholder="Full Name" required>
                            <input type="number" name="year" placeholder="Year (e.g., 3)" required>
                            <select name="program_id" required>
                                <option value="" disabled selected>Select Program</option>
                                <% programs.forEach(p => { %>
                                    <option value="<%= p.program_id %>"><%= p.degree %> - <%= p.branch_name %></option>
                                <% }); %>
                            </select>
                            <button type="submit" class="btn-submit">Add Student</button>
                        </form>
                    </div>
                    <div class="form-column">
                        <h3>Upload Students via Excel</h3>
                        <form action="/upload-students-excel" method="post" enctype="multipart/form-data">
                            <input type="file" name="userFile" accept=".xlsx" required>
                            <button type="submit" class="btn-upload">Upload Student File</button>
                        </form>
                        <!-- MODIFIED: Instructions updated for degree and branch_code -->
                        <div class="instructions">
                            <h4>Excel File Format:</h4>
                            <p>Columns must be in this exact order:</p>
                            <ol>
                                <li><strong>user_id</strong> (Roll Number)</li>
                                <li><strong>user_name</strong> (Full Name)</li>
                                <li><strong>year</strong> (e.g., 3)</li>
                                <li><strong>degree</strong> (e.g., B.Tech)</li>
                                <li><strong>branch_code</strong> (e.g., CSE)</li>
                            </ol>
                            <p><strong>Important:</strong> The combination of `degree` and `branch_code` must already exist in the `programs` table.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Faculty Management Tab -->
            <div id="faculty" class="tab-content">
                <div class="form-section">
                    <div class="form-column">
                        <h3>Add Faculty Manually</h3>
                        <form action="/add-faculty-manual" method="post">
                            <input type="text" name="user_id" placeholder="Faculty ID" required>
                            <input type="text" name="user_name" placeholder="Full Name" required>
                            <input type="text" name="designation" placeholder="Designation (e.g., Professor)" required>
                            <select name="department_id" required>
                                <option value="" disabled selected>Select Department</option>
                                <% departments.forEach(d => { %>
                                    <option value="<%= d.department_id %>"><%= d.department_name %></option>
                                <% }); %>
                            </select>
                            <button type="submit" class="btn-submit">Add Faculty</button>
                        </form>
                    </div>
                     <div class="form-column">
                        <h3>Upload Faculty via Excel</h3>
                        <form action="/upload-faculty-excel" method="post" enctype="multipart/form-data">
                            <input type="file" name="userFile" accept=".xlsx" required>
                            <button type="submit" class="btn-upload">Upload Faculty File</button>
                        </form>
                        <div class="instructions">
                            <h4>Excel File Format:</h4>
                            <p>Columns must be in this exact order:</p>
                            <ol>
                                <li><strong>user_id</strong> (Faculty ID)</li>
                                <li><strong>user_name</strong> (Full Name)</li>
                                <li><strong>department_name</strong></li>
                                <li><strong>designation</strong> (e.g., Professor)</li>
                            </ol>
                             <p><strong>Important:</strong> The `department_name` must already exist in the `departments` table.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>

